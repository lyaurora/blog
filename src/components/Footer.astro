---

import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
---

<!--<div class="border-t border-[var(&#45;&#45;primary)] mx-16 border-dashed py-8 max-w-[var(&#45;&#45;page-width)] flex flex-col items-center justify-center px-6">-->
<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>
<!--<div class="transition bg-[oklch(92%_0.01_var(&#45;&#45;hue))] dark:bg-black rounded-2xl py-8 mt-4 mb-8 flex flex-col items-center justify-center px-6">-->
<div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6">
    <div class="transition text-50 text-sm text-center">
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name}. All Rights Reserved./
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('rss.xml')}>RSS</a><br>
        Powered by
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a>
<div class="text-xs text-50/80 text-center mt-0.5 flex items-center justify-center gap-1 opacity-80 hover:opacity-100 transition-opacity">
    <span class="scale-90">⏳</span>
    <span>本站已运行</span>
    <uptime-display data-start="2025-12-14" class="font-mono font-bold text-[var(--primary)]">Loading...</uptime-display>
</div>

<script is:inline>
    // 使用自定义元素 (Web Component) 解决 Swup 切换和作用域问题
    if (!customElements.get('uptime-display')) {
        class UptimeDisplay extends HTMLElement {
            connectedCallback() {
                // 安全地解析日期，避免 iOS/Android 兼容性问题
                const startStr = this.dataset.start || "2025-12-14";
                const [year, month, day] = startStr.split('-').map(Number);
                this.startTime = new Date(year, month - 1, day).getTime();
                
                this.update();
                this.timer = setInterval(() => this.update(), 1000);
            }

            disconnectedCallback() {
                if (this.timer) clearInterval(this.timer);
            }

            update() {
                const now = Date.now();
                const diff = now - this.startTime;
                if (diff < 0) {
                    this.innerText = "即将诞生";
                    return;
                }
                const days = Math.floor(diff / 86400000);
                const hours = Math.floor((diff % 86400000) / 3600000).toString().padStart(2, '0');
                const minutes = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
                const seconds = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
                this.innerText = `${days}天 ${hours}:${minutes}:${seconds}`;
            }
        }
        customElements.define('uptime-display', UptimeDisplay);
    }
</script>
    </div>
</div>